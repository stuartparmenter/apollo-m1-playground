# Â© Copyright 2025 Stuart Parmenter
# SPDX-License-Identifier: MIT

# Visual FX Page
# Interactive visual effects using lvgl-canvas-fx
# Includes physics simulations and dynamic effects
#
# Required vars:
#   page_friendly_name: Name of the page (e.g., Visual FX)

lvgl_page_manager:
  pages:
    - page: fx_page
      friendly_name: "${page_friendly_name}"

external_components:
  - source: github://stuartparmenter/lvgl-canvas-fx@v0.3.1
    components: [lvgl_canvas_fx]

select:
  - platform: template
    id: fx_effect_select
    name: "Effect"
    optimistic: true
    options:
      - circle
      - fireworks
      - fireplace
      - aurora
    initial_option: fireworks
    set_action:
      - lvgl_canvas_fx.set_effect:
          id: cfx
          effect: !lambda 'return x;'

lvgl_canvas_fx:
  - id: cfx
    effect: fireworks  # or circle or fireplace
    canvas: fx_canvas
    fps: 30
    start_paused: true

lvgl:
  pages:
    - id: fx_page
      widgets:
        - canvas:
            id: fx_canvas
            width: ${DISPLAY_W}
            height: ${DISPLAY_H}
      on_load:
        then:
          # Keep the selected option authoritative: sync effect to current select value
          - lvgl_canvas_fx.set_effect:
              id: cfx
              effect: !lambda 'return id(fx_effect_select).state;'
          - lvgl_canvas_fx.resume:
              id: cfx
      on_unload:
        then:
          - lvgl_canvas_fx.pause:
              id: cfx
